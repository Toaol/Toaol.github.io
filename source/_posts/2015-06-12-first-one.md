---
layout: post
title: "使用 Octopress 打造个人博客"
date: 2015-06-11 13:10:08 +0800
comments: true
categories: 乱七八糟
---

终于把个人博客给搭建起来了。第一篇文章，就介绍一下使用 Octopress 打造个人博客的全过程。


## 0. 什么是 Octopress
Octopress 是基于 Jekyll 的一个静态博客生成工具，使用 Ruby 语言编写，能通过简单的配置生成一个静态网站，还能托管到 Github Pages，免费并且独立。 

除此之外，Octopress 还提供了许多的第三方插件和主题，要是动手能力强还可以自己去制作插件。

## 1. 环境搭建
### 1.1 Git
我使用的是 Windows 操作系统，需要到[http://git-scm.com/download/](http://git-scm.com/download/)下载 Git 的 Windows 版本。

Git 的使用可以参考[这个教程](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000)。
<!--more-->
### 1.2 Ruby
由于 Octopress 使用 Ruby 语言编写，因此必须要有 Ruby 环境的支持，在它的官方站点[https://www.ruby-lang.org/zh_cn/downloads/](https://www.ruby-lang.org/zh_cn/downloads/)下载最新版本，目前稳定版本是2.2.2。安装完后在命令行输入`ruby -v`，如果显示版本信息，则安装成功。

完成 Ruby 的安装之后，还需要安装 DevKit 工具包。DevKit 是 Ruby 安装 C 扩展所必须的工具，在[http://rubyinstaller.org/downloads](http://rubyinstaller.org/downloads/)下载特定版本的 DevKit，双击安装完成后进入安装目录。执行：
```ruby
ruby dk.rb init
```
此时会在此目录上生成一个 config.yml 文件。用记事本打开后在最后面加上一行，添加上
```ruby
 - ruby安装根目录完整路径（是根目录不是bin目录）
```
然后执行
```ruby
ruby dk.rb install
```
搞定。

还有一个天朝特色问题。身处天朝，在使用 gem 工具安装第三方工具的时候，由于服务器在墙外，可能会出现网络错误的情况。可以使用[淘宝的 RubyGems 镜像](http://rubyinstaller.org/downloads/)。戳进去跟着设置，几步就能搞定。

## 3. 本地配置
### 3.1 本地安装
打开命令提示符，依次执行：
```
git clone git://github.com/imathis/octopress.git octopress
cd otcopress
gem install bundler -V
bundle install 
```
此时本地的 Octopress 安装完毕，就是这么简单，由于需要安装的东西比较多，可能用的时间比较长，耐心的就好。

下一步安装默认主题。执行
```
rake install
```
再执行
```
rake preview
```
即可在本地预览。打开浏览器，输入`localhost:4000`，就能看见默认的博客内容了。

### 3.2 发布内容
接下来就应该要发布内容。打开命令提示符，进入到 Octopress 目录，输入
```
rake new_post["title"]
```
自己写一个 tile，此时在 `source/_post`下就能生成一个 Markdown 文件，打开编辑器编辑这个文件。顺便说一下，Windows 下的 Markdown 编辑器感觉都不是特别的好，这一款[小书匠编辑器](http://markdown.xiaoshujiang.com/)用起来还行，滚动什么的特别渣，不过同步功能不错，能同步编辑印象笔记。要是想要 geek 范一点，可以用一些文本编辑器配上 Markdown 插件。现在就是在使用 Sublime text 编辑器配上 MarkdownEditing 插件，特别爽。

编辑完成后，执行
```
rake generate
rake preview
```
即可查看新的内容。

## 4. Github Pages
光在本地一点都不好玩，现在就把它部署到 Github 上，这样小伙伴们才能看到嘛。

首先创建一个仓库，取名为 username.github.io，username 就是自己的 Github 用户名，创建完成会得到一个 SSH 地址。再在本地执行
```
rake setup_github_pages
```
会提示你输入 SSH，把那段地址复制过来粘贴到这里就行。
接下来执行
```
rake generate
rake deploy
```
现在就能在 `http://username.github.io`访问自己的博客了。

现在已经基本完成了，只是还有一个小问题。远程的 master 分支是整个网站，而本地的这些东西是代码本身，本地是没有master分支的。所有最好建立一个 source 分支同步代码，这样当本地的代码发生不测的时候还能从容不迫地 clone 下远程库的代码来，否则的话……

执行命令
```
git add .
git commit -m "submit code"
git push origin source
```
这样会建立一个 source 分支并把本地代码同步到 source。当然，这一步也可以不用做。

## 5. 深度配置
### 5.1 第三方主题
Octopress 提供了非常多的第三方主题，可以在[这个页面](https://github.com/imathis/octopress/wiki/3rd-Party-Octopress-Themes)找到。

安装第三方主题也很简单，我的博客使用了 greyshade 主题，执行：
```
git clone git@github.com:shashankmehta/greyshade.git .themes/greyshade
echo "\$greyshade: color;" >> sass/custom/_colors.scss //Substitue 'color' with your highlight color
rake "install[greyshade]"
rake generate
```
即可完成操作。

不过，当安装好这些东西后，浏览器打开，会发现异常缓慢，这还是天朝特色。F12 看了看，发现所请求的一个来自 Twitter 和 一个来自 Google 的 js 文件花了 30 多秒，这个问题直接在代码里面把请求资源的代码注释掉即可。

### 5.2 汉化
开始的时候，网站的大多数内容都是英文的，需要对其进行汉化。

汉化可以简单粗暴一点，在 source 文件夹里面定位要改的词什么的，改过来就好了。

### 5.3 评论系统
Octopress 自带有一个 disqus 评论系统，去申请一个用户名再添加到 _config.yml 文件里面就好，不过这个评论系统不太符合中国国情，可以使用[多说](http://duoshuo.com/)评论系统。

添加多说评论系统可以参考[这个教程](http://havee.me/internet/2013-02/add-duoshuo-commemt-system-into-octopress.html)。

## 最后：一个奇怪的问题

最后来说一下我遇到的一个奇怪的问题。

在我把网站部署到 Github Pages 之后，进入了我的 Github 页面，一时手贱，添加了一个 README.md 文件，我以为到时候直接  `git pull`  就好。当下一次同步的时候，我才发现远程的 master 分支是网站，而本地的这些东西是代码，在本地压根就没有 master 分支。

部署网站的时候，远程库就比本地库领先一步，这样就没办法部署。其实这个问题是很好解决的，强制覆盖远程库就行了，然而，我并不知道执行 `rake deploy` 的时候发生了什么，我只知道肯定是生成了一个静态网站，这个静态网站就是真正的本地 master 分支，然后 `git push origin master`。

接着，我把远程 master 分支 clone 下来，回退版本到 create README.md 之前，再同步远程库。然而，并没有什么 egg 用。这个，我至今百思不得其解，感觉上是完全没有问题的，不过就是不成，我也木有办法。

最后，我从 rake 这个命令上去想这个问题。我知道 rake 一定会触发某个脚本，在那个脚本里面完成这一系列的工作。我随便到一个目录下执行这个命令，它提示我没有 rakefile 文件。去 octopress 目录下去看，果然找到了 rakefile。

其实到了现在，已经有很多办法解决这个问题了，只要修改 rakefile 就行。只是我被这个问题折腾够了，简单粗暴地在 `git push origin #{deploy_branch}` 后面加上 `--force`。

搞定。

## 参考资料
- [http://shengmingzhiqing.com/blog/setup-octopress-with-github-pages.html/](http://shengmingzhiqing.com/blog/setup-octopress-with-github-pages.html/)
- [http://lucida.me/blog/my-first-article/](http://lucida.me/blog/my-first-article/)
- [http://812lcl.com/blog/2013/10/26/octopressce-bian-lan-ji-ping-lun-xi-tong-ding-zhi/](http://812lcl.com/blog/2013/10/26/octopressce-bian-lan-ji-ping-lun-xi-tong-ding-zhi/)